<project name="JDEECo-Core" default="all" basedir=".">
	<description>JDEECo build file</description>

	<!-- compile subprojects -->
	<target name="compile-jdeeco" description="Compiles the JDEECo runtime sources" >
		<mkdir dir="${build}/jdeeco"/>
		<javac srcdir="${src}" destdir="${build}/jdeeco" debug="${debug}">
			<classpath>
				<pathelement location="${libs}/jsk-lib.jar"/>
				<pathelement location="${libs}/jsk-platform.jar"/>
				<pathelement location="${libs}/bcel-5.2.jar"/>
			</classpath>
		</javac>
	</target>

	<target name="compile-demo" depends="dist-jdeeco"
        description="Compiles the demos sources" >
		<mkdir dir="${build}/demo"/>
		<javac srcdir="${demo}" destdir="${build}/demo" debug="${debug}">
			<classpath>
				<pathelement location="${libs}/jsk-lib.jar"/>
				<pathelement location="${libs}/jsk-platform.jar"/>
				<pathelement location="${dist}/jdeeco.jar"/>
			</classpath>
		</javac>
	</target>

	<!-- package into jar files -->
	<target name="dist-jdeeco" depends="compile-jdeeco"
        description="Generates a jar with JDEECo runtime" >
		<jar jarfile="${dist}/jdeeco.jar" basedir="${build}/jdeeco" manifest="${src}/../META-INF/MANIFEST.MF">
			<fileset dir="${src}/.." includes="OSGI-INF/*.*"/>
		</jar>
	</target>

	<target name="dist-demo" depends="compile-demo"
        description="Generates a jar with the demos" >
		<jar jarfile="${dist}/demo.jar" basedir="${build}/demo"/>
	</target>

    <!-- package cloud demo ensembles and components into single jar file -->
    <target name="dist-cloud-demo" depends="compile-demo"
        description="Generates a jar with cloud demo main classes" >
        <jar jarfile="${dist}/cloud-demo.jar" basedir="${build}/demo" includes="**/NodeA.class,**/NodeB.class,**/MigrationEnsemble.class">
            <manifest>
                <attribute name="Bundle-Version" value="0.0.1.SNAPSHOT"/>
                <attribute name="Export-Package" value="cz.cuni.mff.d3s.deeco.demo.cloud"/>
                <attribute name="Bundle-Name" value="Cloud demo package" />
                <attribute name="Bundle-SymbolicName" value="cz.cuni.mff.d3s.deeco.demo.cloud" />
            </manifest>
        </jar>
    </target>

	<!-- zip source files -->
	<target name="zip" description="Creates a zip with the source files" >
		<zip destfile="${dist}/sources.zip">
			<zipfileset dir="${src}"/>
			<zipfileset dir="${demo}"/>
		</zip>
	</target>
	
	<target name="all">
		<antcall target="dist-demo"/>
		<antcall target="zip"/>
	</target>
	
</project>
